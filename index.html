<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>

  <body>
    <script>
      "use strict";
      class MaxSlidingWindow {
        constructor() {
          this.maxSlidingWindow = (arr, k) => {
            const result = [];
            const heap = [];
            for (let i = 0; i < arr.length; i++) {
              this.cleanHeap(heap, i, k);
              this.pushHeap(heap, [arr[i], i]);
              if (i >= k - 1) {
                result.push(heap[0][0]);
              }
            }
            return result;
          };
        }
        heapifyDown(heap) {
          let i = 0;
          while (true) {
            let left = i * 2 + 1;
            let right = i * 2 + 2;
            let largest = i;
            if (left < heap.length && heap[left][0] > heap[largest][0]) {
              largest = left;
            }
            if (right < heap.length && heap[right][0] > heap[largest][0]) {
              largest = right;
            }
            if (i === largest) break;
            [heap[i], heap[largest]] = [heap[largest], heap[i]];
            i = largest;
          }
        }
        popHeap(heap) {
          const lastElement = heap.pop();
          if (heap.length <= 0 || lastElement === undefined) return;
          heap[0] = lastElement;
          this.heapifyDown(heap);
        }
        cleanHeap(heap, currentIndex, k) {
          while (heap.length > 0 && heap[0][1] <= currentIndex - k) {
            this.popHeap(heap);
          }
        }
        heapifyUp(heap) {
          let i = heap.length - 1;
          while (i > 0) {
            const parentIndex = Math.floor((i - 1) / 2);
            console.log(parentIndex);
            if (heap[parentIndex][0] >= heap[i][0]) break;
            [heap[parentIndex], heap[i]] = [heap[i], heap[parentIndex]];
            i = parentIndex;
          }
        }
        pushHeap(heap, value) {
          heap.push(value);
          this.heapifyUp(heap);
        }
      }
      const heap = new MaxSlidingWindow();
      console.log(heap.maxSlidingWindow([1, 3, -1, -3, 5, 3, 6, 7], 3));
    </script>
  </body>
</html>
